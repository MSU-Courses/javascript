# Ключевое слово `this`

Из других языков программирования, таких как C++ и Java, вам уже известно о ключевом слове `this`.

В языке JavaScript ключевое слово `this` обозначает почти то же самое, что и в других языках программирования, однако оно обладает своими особенностями.

Многие не понимают, для чего оно используется и как его применять, поскольку оно действительно может вызвать много трудностей.

Мы ограничимся лишь основами данной темы и не будем углубляться в детали, поскольку это может затруднить дальнейшее понимание. 

Попытаемся разобрать данное ключевое слово сразу на практике.

## Ключевое слово `this` в объектах

### Предисловие

Рассмотрим задачу.  Предположим, у нас есть объект `player`, который содержит свойство `username`. Нам нужно создать метод объекта, который выводил бы приветствие и имя пользователя (`username`).

То есть,
```js
const player = {
    username: "Alex",
    greet() {
        // ...
    }
}

player.greet(); // "Hi, my name is Alex"
```

С одной стороны, кажется, что реализация несложная. Попробуем самый банальный способ:

```js
const player = {
    username: "Alex",
    greet() {
        console.log(`Hi, my name is ${username}`);
    }
}

// Uncaught ReferenceError: username is not defined
player.greet();
```

В данном случае выбрасывается ошибка, так как переменная `username` не определена в контексте функции `greet()`.

В других языках данное обращение сработало бы, но в JavaScript контекст выполнения функции `greet()` не подразумевает автоматическое распознавание переменной `username` как свойства объекта. Так как переменная `username` **не была определена внутри функции или не является глобальной переменной**, JavaScript не может найти ее в контексте выполнения функции `greet()`.

Проще говоря, можно сказать, что функция greet не имеет доступа к свойствам объекта, в частности, она не распознает переменную `username`.

Теперь попробуем это сделать по другому.

```js
const player = {
    username: "Alex",
    greet() {
        console.log(`Hi, my name is ${this.username}`);
    }
}

player.greet(); // "Hi, my name is Alex"
```

Теперь программа работает корректно, но мы добавили ключевое слово `this`. Уже поняли, что это такое?

Прежде чем понять, что такое `this`, попробуйте выполнить следующий код.

```js
const player = {
    name: "Alex",
    age: 23,
    greet() {
        console.log("Hi!");
    },
    displayThis() {
        console.log(this);
    }
}

player.displayThis();
// Будет выведено
/* 
{
    name: 'Alex',
    age: 23,
    greet: [Function: greet],
    displayThis: [Function: displayThis]
} 
*/
```

Стало более понятно? 

То есть, в контексте данного примера, в объекте `player` ключевое слово `this` указывает на сам объект `player`.

### `this` в контексте объектов

> [!NOTE]
> `this` в JavaScript - это ключевое слово, которое ссылается на текущий объект, в контексте которого оно используется.

То есть, более простыми словами, когда мы используем `this`, мы обращаемся к текущему объекту, в котором находится код, где это слово используется.

Еще один пример,

```js
const person = {
  name: 'Alice',
  age: 23,
  greet() {
    console.log(`Hello, my name is ${this.name}, i'm ${this.age} year old`);
  }
};

person.greet(); // Вывод: Hello, my name is Alice
```

Мы можем обойтись без ключевого слова `this`, но в данном случае такой способ не надежен при копировании объектов и **не рекомендуется для использования**.

```js
const person = {
    name: 'Alice',
    greet() {
        console.log(`Hello, my name is ${person.name}.`);
    }
}
```

## Контексты `this`

Помимо использования ключевого слова `this` в объектах, мы также можем его использовать в других контекстах, например, в функциональном контексте (то есть в функции).

### Функциональный контекст

Напомним, что функции в JS также являются объектами, поэтому мы можем использовать ключевое слово `this` и внутри них. 

_Эта тема может быть непонятной для многих студентов, но давайте попробуем рассмотреть её поверхностно._

Рассмотрим пример.
```js
function func() {
    this.name = "Alex";
    console.log(this.name);
}
```

Теперь рассмотрим вариант, когда мы присвоим функцию некоторому объекту.
```js
// Определяем функцию greet(), которая выводит приветственное сообщение,
// используя свойство name объекта, на котором она вызывается
function greet() {
    console.log(`Hi, my name is ${this.name}`);
}

// Создаём объект player с свойством name и методом greet,
// который ссылается на функцию greet()
const player = {
    name: "James", // Имя игрока
    greet, // Присваиваем метод greet объекту player
}

// Создаём объект user с свойством name и методом greet,
// который также ссылается на функцию greet()
const user = {
    name: "User", // Имя пользователя
    greet, // Присваиваем метод greet объекту user
};

// Вызываем метод greet() объекта player
// Функция greet() выполняется в контексте объекта player,
// так что this.name внутри неё указывает на свойство name объекта player
player.greet();

// Вызываем метод greet() объекта user
// Функция greet() выполняется в контексте объекта user,
// так что this.name внутри неё указывает на свойство name объекта user
user.greet();
```

Данный код иллюстрирует использование ключевого слова `this` в JavaScript в контексте функций, когда они присваиваются как методы объектов.

При вызове `player.greet()` в консоль будет выведено **"Hi, my name is James"**, потому что `this.name` внутри функции `greet()` указывает на свойство `name` объекта `player`, аналогично, при вызове `user.greet()` будет выведено **"Hi, my name is User"**, потому что `this.name` указывает на свойство `name` объекта `user`.

Это происходит потому, что когда мы вызываем функцию `greet()`, то значение `this` внутри неё определяется тем объектом, который вызывает эту функцию. То есть, в зависимости от объекта, который вызывает функцию `greet()`, `this` будет указывать на разные свойства `name`. Именно поэтому мы можем использовать одну и ту же функцию `greet()` для разных объектов и она будет выводить разные имена в зависимости от контекста, в котором она вызывается.