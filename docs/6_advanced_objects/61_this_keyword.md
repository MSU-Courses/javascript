# Ключевое слово `this`

Из других языков программирования, таких как C++ и Java, вам уже известно о ключевом слове `this`.

В языке JavaScript ключевое слово `this` обозначает почти то же самое, что и в других языках программирования, однако оно обладает своими особенностями.

Многие не понимают, для чего оно используется и как его применять, поскольку оно действительно может вызвать много трудностей.

Мы ограничимся лишь основами данной темы и не будем углубляться в детали, поскольку это может затруднить дальнейшее понимание. 

Попытаемся разобрать данное ключевое слово сразу на практике.

## Ключевое слово `this` в объектах

### Предисловие

Рассмотрим задачу.  Предположим, у нас есть объект `player`, который содержит свойство `username`. Нам нужно создать метод объекта, который выводил бы приветствие и имя пользователя (`username`).

То есть,
```js
const player = {
    username: "Alex",
    greet() {
        // ...
    }
}

player.greet(); // "Hi, my name is Alex"
```

С одной стороны, кажется, что реализация несложная. Попробуем самый банальный способ:

```js
const player = {
    username: "Alex",
    greet() {
        console.log(`Hi, my name is ${username}`);
    }
}

// Uncaught ReferenceError: username is not defined
player.greet();
```

В данном случае выбрасывается ошибка, так как переменная `username` не определена в контексте функции `greet()`.

В других языках данное обращение сработало бы, но в JavaScript контекст выполнения функции `greet()` не подразумевает автоматическое распознавание переменной `username` как свойства объекта. Так как переменная `username` **не была определена внутри функции или не является глобальной переменной**, JavaScript не может найти ее в контексте выполнения функции `greet()`.

Проще говоря, можно сказать, что функция greet не имеет доступа к свойствам объекта, в частности, она не распознает переменную `username`.

Теперь попробуем это сделать по другому.

```js
const player = {
    username: "Alex",
    greet() {
        console.log(`Hi, my name is ${this.username}`);
    }
}

player.greet(); // "Hi, my name is Alex"
```

Теперь программа работает корректно, но мы добавили ключевое слово `this`. Уже поняли, что это такое?

Прежде чем понять, что такое `this`, попробуйте выполнить следующий код.

```js
const player = {
    name: "Alex",
    age: 23,
    greet() {
        console.log("Hi!");
    },
    displayThis() {
        console.log(this);
    }
}

player.displayThis();
// Будет выведено
/* 
{
    name: 'Alex',
    age: 23,
    greet: [Function: greet],
    displayThis: [Function: displayThis]
} 
*/
```

Стало более понятно? 

То есть, в контексте данного примера, в объекте `player` ключевое слово `this` указывает на сам объект `player`.

### `this` в контексте объектов

> [!NOTE]
> `this` в JavaScript - это ключевое слово, которое ссылается на текущий объект, в контексте которого оно используется.

То есть, более простыми словами, когда мы используем `this`, мы обращаемся к текущему объекту, в котором находится код, где это слово используется.

Еще один пример,

```js
const person = {
  name: 'Alice',
  age: 23,
  greet() {
    console.log(`Hello, my name is ${this.name}, i'm ${this.age} year old`);
  }
};

person.greet(); // Вывод: Hello, my name is Alice
```

Мы можем обойтись без ключевого слова `this`, но в данном случае такой способ не надежен при копировании объектов и **не рекомендуется для использования**.

```js
const person = {
    name: 'Alice',
    greet() {
        console.log(`Hello, my name is ${person.name}.`);
    }
}
```

## Контексты `this`

Ключевое слово `this` не является фиксированным и может меняться в зависимости от контекста, в котором оно используется. То есть простыми словами, `this` зависит от того, где и как используется.

То есть, значения this будут разными, в зависимости от того, где и как используется.

Сначала поймем, что такое контекст выполнения. Мы уже обсуждали данную тему ранее.

> [!NOTE]
> Контекст выполнения - это область видимости, в которой выполняется код. В контексте выполнения определены переменные, функции, объекты и т.д.

Другими словами, контекст выполнения - это место, где код выполняется.

```js
// Код выполняется в глобальном контексте 
const a = 3;

const person = {
    name: 'Alice',
    greet() {
        // Код выполняется в контексте объекта person
        console.log(this);
    }
}
```
Например,
* Когда мы используем `this` внутри метода объекта, `this` ссылается на сам объект, в контексте которого используется. 

* Когда мы используем `this` в глобальном контексте, `this` ссылается на глобальный объект.

Значение `this` вычисляется во время выполнения кода. Это означает, что значение `this` зависит от того, где и как используется.

_Эта тема может быть непонятной для многих студентов, но давайте попробуем рассмотреть её поверхностно._

### Глобальный контекст

> [!NOTE]
> **Глобальный контекст в JavaScript** — это базовый уровень программы, где не находится внутри функций или объектов. Когда мы работаем в глобальном контексте, this обычно ссылается на глобальный объект.

Что будет если мы будем использовать `this` глобально? То есть зайдем в браузер или в консоль NodeJS и выведем значение `this`?

```js
console.log(this);
```

_Ответ простой_: если мы будем использовать `this` глобально в браузере или в консоли Node.js, то оно обычно будет указывать на глобальный объект. В браузере это объект `window`, а в Node.js - объект `global`.


А что такое _глобальный объект_?

**Глобальный объект в JavaScript (`Global Object`)** представляет собой специальный объект, который доступен в любой точке кода в программе на JavaScript. В браузере глобальный объект называется window, а в среде выполнения Node.js - global.

Глобальный объект содержит множество встроенных свойств и методов, которые могут быть использованы в любом месте программы без явного обращения к объекту. **Например**, объект console, который помогаете выводить сообщения в консоль.

Глобальный объект также является местом, где хранятся глобальные переменные, которые могут быть доступны из любой точки программы. 

То есть мы можем представить нашу программу, как один большой объект.

### `this` в функциях

Когда мы используем `this` внутри функции, значение `this` зависит от того, как и где функция была вызвана.

Например, мы уже рассмотрели пример с объектом. 

* Если функция является свойством объекта (методом), то при использовании `this` в функции, будет использован контекст объекта.

```js
const obj = {
    a: 1,
    b: [1, 2, 3],

    // Метод log, который выводит текущий объект в консоль
    // В данном случае this указывает на текущий объект,
    // так как этот метод будет вызываться из контекста объекта.
    log() {
        console.log(this);
    }
}

obj.log(); // { a: 1, b: [ 1, 2, 3 ], log: [Function: log] }
```

* Если функция вызывается без контекста объекта, то значение `this` будет указывать на глобальный объект.

```js
function logThis() {
    console.log(this);
}

// this указывает на глобальный объект
// так как функция вызывается в глобальном контексте
// В браузере: Window, в Node.js: global
logThis();
```

Одна и та же функция может использоваться в разных контекстах, и значение `this` будет разным в зависимости от контекста.

```js
// Определяем функцию greet(), которая выводит приветственное сообщение,
// используя свойство name объекта, на котором она вызывается
function greet() {
    console.log(`Hi, my name is ${this.name}`);
}

// Вызываем функцию greet() в глобальном контексте
// Поскольку нет объекта, на котором она вызывается,
// this.name будет undefined
greet();

// Создаём объект player с свойством name и методом greet,
// который ссылается на функцию greet()
const player = {
    name: "James", // Имя игрока
    greet, // Присваиваем метод greet объекту player
}

// Создаём объект user с свойством name и методом greet,
// который также ссылается на функцию greet()
const user = {
    name: "User", // Имя пользователя
    greet, // Присваиваем метод greet объекту user
};

// Вызываем метод greet() объекта player
// Функция greet() выполняется в контексте объекта player,
// так что this.name внутри неё указывает на свойство name объекта player
player.greet();

// Вызываем метод greet() объекта user
// Функция greet() выполняется в контексте объекта user,
// так что this.name внутри неё указывает на свойство name объекта user
user.greet();
```
