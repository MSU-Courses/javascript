# Обработка ошибок, конструкция `try ... catch`

Одной из ключевых тем в программировании является обработка ошибок. Несмотря на наши старания писать код без ошибок, иногда возникают ситуации, способные вызвать ошибки. Это может произойти по нашей вине или по вине пользователей, вводящих данные.

При обнаружении ошибки программа обычно завершает выполнение или, как принято говорить в мире IT, "падает".

Однако как мы можем защититься от этого? Для этого предусмотрена конструкция `try ... catch`, которая позволяет нам обрабатывать ошибки.

Более подробно об ошибках было рассказано на курсах "Основы программирования" и "ООП", на данный момент мы рассмотрим основные аспекты в языке JavaScript.

## Конструкция `try ... catch`

Синтаксис конструкции `try ... catch` довольно прост:

```js
try {
    // Код, который может вызвать ошибку
} catch (err) {
    // Код, который выполняется в случае возникновения ошибки
}
```

1. В блоке `try` размещается код, который может вызвать ошибку.
2. Если ошибка происходит внутри этого блока, выполнение программы переходит к блоку `catch`, где `err` - это объект ошибки, который содержит информацию о произошедшем сбое.

Таким образом мы можем контролировать появившиеся ошибки.

Рассмотрим пример.
```js
try {
    console.log("Начало try");
    
    // будет сгенерирована ошибка: переменная player не определена
    player.street = "80 St. Luie Avenue";
    
    console.log("Конец try");
} catch (err) {
    console.log("Переменной player не существует");
}

// Результат:
// "Начало try"
// "Переменной player не существует"
```

> [!NOTE]
> Конструкция `try ... catch` применима только на этапе выполнения кода. Синтаксические ошибки не подпадают под её область действия и не могут быть перехвачены.

В объекте ошибки (`err`) содержится следующая информация:
1. `err.name` — имя ошибки.
2. `err.message` — текст ошибки.
3. `err.stack` — текущий стек вызова, который представляет собой строку, содержащую информацию о функциях и их вызовах, приведших к возникновению ошибки.

Ещё одним примером ошибки может служить попытка преобразования JSON в объект. Если JSON неверен, функция `JSON.parse` сгенерирует ошибку.

```js
const json = `{nickname": "Piotr", "hp: 22}`;

try {
    const player = JSON.parse(json);
} catch (err) {
    console.log("Неверный JSON формат.")
}
```

## Генерация пользовательских ошибок

Часто возникает ситуация, когда мы сами хотим сгенерировать ошибку. Это может быть необходимо, когда мы разрабатываем программное обеспечение для других пользователей, или пишем библиотеки.

Для генерации пользовательской ошибки используется ключевое слово `throw <объект ошибки>`.

Хотя я указал, что после оператора `throw` должен следовать **объект ошибки**, допускается использование любых типов данных:

```javascript
throw 1;
throw "error";
throw [1, 2, 3];
throw {
    error: "error"
};
```

Существует ряд предопределенных конструкторов для ошибок, которые мы можем использовать.
```js
throw new Error("error");
throw new SyntaxError("error");
throw new ReferenceError("error");
// и другие ...
```

> [!TIP]
> Инструкция `throw` прерывает выполнение текущей функции.

Рассмотрим пример.
```js
/**
 * Выполняет деление двух чисел.
 *
 * @param {number} a - Первое число (делимое).
 * @param {number} b - Второе число (делитель).
 * @returns {number} - Результат деления первого числа на второе.
 * @throws {Error} - Выбрасывает ошибку, если второе число равно 0.
 */
function div(a, b) {
    if (b === 0) {
        throw new Error("divide by zero");
    }

    return a / b;
}

try {
    div(1, 0);
} catch (err) {
    console.log(err.message);
}
```

## Ключевое слово `finally`

Конструкция `try ... catch` может содержать еще ключевое слово `finally`.

Этот участок кода выполнится в любом случае, независимо от того, выполнится ли блок try успешно или будет перехвачена ошибка и выполнится блок catch.

```javascript
try {
    player.street = "87 St. Luie Avenue";
} catch (err) {
    console.log("Объекта player не существует");
} finally {
    console.log("Блок finally выполнится независимо от результата выполнения try-catch.");
}
```

Зачем использовать `finally`? Данную секцию часто используют для инструкций, которые необходимо выполнить независимо от того, возникнет ли ошибка или нет.